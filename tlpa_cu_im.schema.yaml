# Rime schema
# vim: set sw=2 sts=2 et:
# encoding: utf-8

schema:
  schema_id: tlpa_cu_im
  name: 河洛注音
  version: "v0.0.0.1"
  author: 居正中
  description: |
    河洛話白話音, 採用「TLPA標音方案」
    以「白話音」為主；「文讀音」為輔。

    鍵盤對應：
      ㄅ ㄉ ３ ２ ７ ５ ． ㄚ ㄞ ㄢ ｎ
      ㄆ ㄊ ㄍ ㄐ ㆣ ㄗ ㄧ ㆦ ㆤ ㄣ
      ㄇ ㄋ ㄎ ㄑ ㄫ ㄘ ㄨ ㄜ ㄠ ㄤ
      ㆠ ㄌ ㄏ ㄒ Ｊ ㄙ ㆬ ㆰ ㆲ ㆭ

switches:
  - name: ascii_mode
    reset: 0
    states: [漢文, ABC]
  - name: full_shape
    reset: 0
    states: [半形, 全形]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - r10n_translator
    - reverse_lookup_translator
  filters:
    - simplifier
    - uniquifier

speller:
  alphabet: 'abcdefghijklmnopqrstuvwxyz~[/\]90-;'
  initials: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    # 零聲母處理
    - derive/q//
    - derive/Ø//
    # 通配
    - derive/ts/c/
    - derive/ou/oo/
    - derive/e(ng|k)/i$1/
    - derive/ei/e/
    # 鼻化韻處理
    - derive/([^u])enn/$1eenn/
    - xform/b(.+)nn/m$1/
    - xform/l(.+)nn/n$1/
    - xform/g(.+)nn/ng$1/
    - derive/([^blg])(.+)nn/$1$2/
    # 聲母簡拼
    - abbrev/^([lpktcjsqbghmn])([^hsg]).+$/$1/
    - abbrev/^(ph).+$/$1/
    - abbrev/^(th).+$/$1/
    - abbrev/^(kh).+$/$1/
    - abbrev/^(ng).+$/$1/
    - abbrev/^(ts).+$/$1/
    - abbrev/^(tsh).+$/$1/
    #==========================================
    - derive/^([Øa-z]+)\d$/$1/
    - abbrev/^([ptkmnbglsjhiuc]g?s?h?h?).*/$1/

translator:
  dictionary: tlpa_peh_ue
  spelling_hints: 5
  preedit_format:
    #======================================================
    # 對於已輸入（韻母）（調號）之拼音，需在韻母標「聲調符號」
    #======================================================
    - xlit|[/\]90-;|¹²³⁴⁵⁶⁷⁸|
    - xform/([aeiou])(r?m?n*h?g?p?t?k?)([12345678])/$1$2$3/
    - xform/([aeo])([iueo])([12345678])/$1$2$3/
    #======================================================
    # 鼻化符號顯示成上標
    #======================================================
    - xform/nn(h?)(\d|\>)/$1ⁿ$2/

  comment_format:
    # - derive/^([aeiou])/q$1/
    #======================================
    - derive/^([aeiou])/ø$1/
    - xform/^([a-zø]+\d)$/$1;$1/
    #======================================
    # 聲母
    #======================================
    # 唇音(不送氣音/送氣音/濁音/鼻音)
    - xform/;p(?!h)/\【邊;/
    - xform/;ph/\【頗;/
    - xform/;b/\【門;/
    - xform/;m/\【毛;/
    # 舌尖音
    - xform/;t(?!h)/\【地;/
    - xform/;th/\【他;/
    - xform/;n(?!g)/\【耐;/
    - xform/;l/\【柳;/
    # 舌齒音
    - xform/;c(?!h)/\【曾;/
    - xform/;ch/\【出;/
    - xform/;j/\【入;/
    - xform/;s/\【時;/
    # 舌根音
    - xform/;k(?!h)/\【求;/
    - xform/;kh/\【氣;/
    - xform/;g/\【語;/
    - xform/;ng/\【雅;/
    # 喉音
    - xform/;h/\【喜;/
    # 無聲母
    - xform/;Ø/\【英;/
    - xform/;q/\【英;/
    #======================================
    # 韻母
    #======================================
    - xform/;u(n|t)(\d)/君;$2/
    - xform/;ia(n|t)(\d)/堅;$2/
    - xform/;i(m|p)/金;/
    - xform/;ui(h?)(\d)/規;$2/
    - xform/;ee(h?)/嘉;/
    - xform/;a(n|t)(\d)/干;$2/
    - xform/;o(ng|k)/公;/
    - xform/;uai(h?)/乖;$2/
    - xform/;e(ng|k)/經;/
    - xform/;i(ng|k)/經;/
    - xform/;ua(n|t)(\d)/觀;$2/
    # - xform/;ou(h?)(\d)/沽;$2/
    - xform/;iau(h?)(\d)/嬌;$2/
    - xform/;ei/稽;/
    - xform/;io(ng|k)/恭;/
    # - xform/;o(h?)(\d)/高;$2/
    - xform/;ai(\d)/皆;$1/
    - xform/;i(n|t)(\d)/巾;$2/
    - xform/;ia(ng|k)/姜;/
    - xform/;a(m|p)/甘;/
    - xform/;ua(h?)(\d)/瓜;$2/
    - xform/;a(ng|k)/江;/
    - xform/;ia(m|p)/兼;/
    - xform/;au(h?)(\d)/交;$2/
    - xform/;ia(h?)(\d)/迦;$2/
    - xform/;ue(h?)(\d)/檜;$2/
    - xform/;ann(h?)/監;/
    - xform/;u(h?)(\d)/艍;$2/
    - xform/;a(h?)(\d)/膠;$2/
    - xform/;i(h?)(\d)/居;$2/
    - xform/;iu(\d)/丩;$1/
    - xform/;enn(h?)/更;/
    - xform/;inn(h?)/梔;/
    - xform/;iann/驚;/
    - xform/;uann/官;/
    - xform/;e(h?)(\d)/伽;$2/
    - xform/;ainn(h?)/閒;/
    # - xform/;ounn/姑;/
    - xform/;uenn/糜;/
    - xform/;iaunn(h?)/嘄;/
    - xform/;o(m|p)/箴;/
    - xform/;aunn/爻;/
    # - xform/;onn(h?)/扛;/
    - xform/;iunn/牛;/
    #======================================
    - xform/;io/茄;/
    - xform/;ng/鋼;/
    - xform/;oo(h?)(\d)/沽;$2/
    - xform/;o(h?)(\d)/高;$2/
    # - xform/;oonn/姑;/
    - xform/;ounn/姑;/
    - xform/;onn(h?)/扛;/
    #======================================
    - xform/;1/一】/    # 陰平
    - xform/;2/二】/    # 陰上
    - xform/;3/三】/    # 陰去
    - xform/;4/四】/    # 陰入
    - xform/;5/五】/    # 陽平
    - xform/;6/六】/    # 陽上
    - xform/;7/七】/    # 陽去
    - xform/;8/八】/    # 陽入
    #======================================================
    # 顯示「方音符號」的聲母
    #======================================================
    - xform/^p(?!h)/ㄅ/
    - xform/^ph/ㄆ/
    - xform/^m/ㄇ/
    - xform/^b/ㆠ/
    #------------------------------------------------------
    - xform/^t(?!h)/ㄉ/
    - xform/^th/ㄊ/
    - xform/^n(?!g)/ㄋ/
    - xform/^l/ㄌ/
    #------------------------------------------------------
    - xform/^k(?!h)/ㄍ/
    - xform/^kh/ㄎ/
    - xform/^h/ㄏ/
    - xform/^g/ㆣ/
    - xform/^ng/ㄫ/
    #------------------------------------------------------
    - xform/^ch/ㄘ/
    - xform/^c(?!h)/ㄗ/
    - xform/s/ㄙ/
    - xform/j/ㆡ/
    #======================================================
    # 自「雅俗通十五音」轉化而得的韻母
    #======================================================
    - xform/iang/ㄧㄤ/  # 姜
    - xform/iak/ㄧㄚㆻ/  # 姜
    - xform/iong/ㄧㆲ/  # 恭
    - xform/iok/ㄧㆦㆻ/  # 恭
    - xform/ing/ㄧㄥ/  # 經
    - xform/ik/ㄧㆻ/  # 經
    - xform/iam/ㄧㆰ/  # 兼
    - xform/iap/ㄧㄚㆴ/  # 兼
    - xform/ian/ㄧㄢ/  # 堅
    - xform/iat/ㄧㄚㆵ/  # 堅
    - xform/iann/ㄧㆩ/  # 驚
    - xform/iau/ㄧㄠ/  # 嬌
    - xform/iauh/ㄧㄠㆷ/  # 嬌
    - xform/iaunn/ㄧㆯ/  # 嘄
    - xform/iaunnh/ㄧㆯㆷ/  # 嘄
    - xform/ia(?!n)/ㄧㄚ/  # 迦
    - xform/iah/ㄧㄚㆷ/  # 迦
    - xform/im/ㄧㆬ/  # 金
    - xform/ip/一ㆴ/  # 金
    - xform/in/ㄧㄣ/  # 巾
    - xform/it/ㄧㆵ/  # 巾
    - xform/io/ㄧㄜ/  # 茄
    - xform/ioh/ㄧㄜㆷ/  # 茄
    - xform/ionn/ㄧㆧ/  # 薑
    - xform/iu/ㄧㄨ/  # 丩
    - xform/iunn/ㄧㆫ/  # 牛
    #------------------------------------------------------
    - xform/ai/ㄞ/  # 皆
    - xform/ainn/ㆮ/  # 閒
    - xform/am/ㆰ/  # 甘
    - xform/ap/ㄚㆴ/  # 甘
    - xform/an(?!g)/ㄢ/  # 干
    - xform/at/ㄚㆵ/  # 干
    - xform/ang/ㄤ/  # 江
    - xform/ak/ㄚㆻ/  # 江
    - xform/au/ㄠ/  # 交
    - xform/auh/ㄠㆷ/  # 交
    - xform/aunn/ㆯ/  # 爻
    #------------------------------------------------------
    - xform/ong/ㆲ/  # 公
    - xform/ok/ㆦㆻ/  # 公
    - xform/om/ㆱ/  # 箴
    - xform/op/ㆦㆴ/  # 箴
    #------------------------------------------------------
    - xform/uang/ㄨㄤ/  # 光
    - xform/uak/ㄨㄚㆻ/  # 光
    - xform/uai/ㄨㄞ/  # 乖
    - xform/uaih/ㄨㄞㆷ/  # 乖
    - xform/uann/ㄨㆩ/  # 官
    - xform/uainn/ㄨㆮ/  # 閂
    - xform/uainnh/ㄨㆮㆷ/  # 閂
    - xform/uan/ㄨㄢ/  # 觀
    - xform/uat/ㄨㄚㆵ/  # 觀
    - xform/ua/ㄨㄚ/  # 瓜
    - xform/uah/ㄨㄚㆷ/  # 瓜
    #------------------------------------------------------
    - xform/ue/ㄨㆤ/  # 檜
    - xform/ueh/ㄨㆤㆷ/  # 檜
    - xform/uenn/ㄨㆥ/  # 糜
    - xform/ui/ㄨㄧ/  # 規
    - xform/uinn/ㄨㆪ/  # 褌
    - xform/un/ㄨㄣ/  # 君
    - xform/ut/ㄨㆵ/  # 君
    #------------------------------------------------------
    - xform/a/ㄚ/  # 膠
    - xform/ah/ㄚㆷ/  # 膠
    - xform/ann/ㆩ/  # 監
    - xform/annh/ㆩㆷ/  # 監

    - xform/e/ㆤ/  # 伽
    - xform/eh/ㆤㆷ/  # 伽
    - xform/enn/ㆥ/  # 更
    - xform/ennh/ㆥㆷ/  # 更
    - xform/ee/ㄝ/  # 嘉
    - xform/eeh/ㄝㆷ/  # 嘉
    - xform/ei/ㄟ/  # 稽

    - xform/i/ㄧ/  # 居
    - xform/ih/ㄧㆷ/  # 居
    - xform/inn/ㆪ/  # 梔
    - xform/innh/ㆪㆷ/  # 梔

    - xform/u/ㄨ/  # 艍
    - xform/uh/ㄨㆷ/  # 艍

    - xform/oo/ㆦ/  # 沽
    - xform/ou/ㆦ/  # 沽
    - xform/ounn/ㆧ/  # 姑
    - xform/oonn/ㆧ/  # 姑
    - xform/onn/ㆧ/  # 姑

    - xform/o/ㄜ/  # 高
    - xform/oh/ㄜㆷ/  # 高
    # - xform/onn/ㆧ/  # 扛
    # - xform/onnh/ㆧㆷ/  # 扛
    #======================================================
    # 韻化輔音
    #======================================================
    - xform/m/ㆬ/  # 姆
    - xform/ng/ㆭ/  # 鋼
    - xform/n(?!h)/ㄣ/
    #======================================================
    # 鼻音
    #======================================================
    - xform/nn/N/
    - xform/N((ㄧ|ㄨ)?(ㄧ|ㄨ|ㄚ|ㆦ|ㆤ|ㄞ|ㄠ))/$1N/
    - xform/ㄧN/ㆪ/
    - xform/ㄨN/ㆫ/
    - xform/ㄚN/ㆩ/
    - xform/ㆦN/ㆧ/
    - xform/ㆤN/ㆥ/
    - xform/ㄞN/ㆮ/
    - xform/ㄠN/ㆯ/
    - xform/ㄧㄢㄣ/ㄧㆩ/  # 驚
    #======================================================
    # 校調
    #======================================================
    - xform/ㄜㄜ/ㆦ/
    # 調整 ㄗ ㄘ ㄙ ㆡ 轉 ㄐ ㄑ ㄒ ㆢ
    - xform/ㄗㄧ/ㄐㄧ/
    - xform/ㄘㄧ/ㄑㄧ/
    - xform/ㄙㄧ/ㄒㄧ/
    - xform/ㆡㄧ/ㆢㄧ/
    #======================================================
    # 入聲
    #======================================================
    # 下入聲
    - xform/p8/ㆴ̇/
    - xform/t8/ㆵ̇/
    - xform/k8/ㆻ̇
    - xform/h8/ㆷ̇/
    # 上入聲
    - xform/p/ㆴ/
    - xform/t/ㆵ/
    - xform/k/ㆻ/
    - xform/h/ㆷ/
    # ok 指 ook
    - xform/ㄜ([ ㆴ ㆵ ㆻ ㆷ])/ㆦ$1/
    #======================================================
    # 聲調
    #======================================================
    - 'xform 1 ˉ'    #1
    - 'xform 2 ˋ'    #2
    - 'xform 3 ˪'    #3
    - 'xform 4  '    #4
    - 'xform 5 ˊ'    #5
    # - 'xform 6  ̌'    #6
    - 'xform 7 ˫'    #7
    - 'xform 8 ˙'    #8

custom_phrase:
  dictionary: ""
  user_dict: custom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 1

punctuator:
  import_preset: tlpa_utl_symbols

recognizer:
  patterns:
    email: ^[a-z][-_.0-9a-z]*@.*$
    uppercase: ^[A-Z][-_+.'0-9A-Za-z]*$
    url: ^(www[.]|https?:|ftp:|mailto:).*$
    punct: '`[^\s]$'

style:
  horizontal: false

key_binder:
  import_preset: default
  bindings:
    # - { accept: minus, send: Page_Up, when: has_menu }    # 換上一個選單
    # - { accept: equal, send: Page_Down, when: has_menu }  # 換下一個選單
    - { accept: comma, send: Up, when: has_menu }         # 選下一個字
    - { accept: period, send: Down, when: has_menu }      # 選上一個字
    - { accept: "Control+p", send: Page_Up, when: composing }
    - { accept: "Control+n", send: Page_Down, when: composing }
    - { accept: "Control+g", send: space, when: composing }
    #---------------------------------------------------
    - { when: has_menu, accept: "Control+h", send: Page_Up }
    - { when: has_menu, accept: "Control+l", send: Page_Down }
    - { when: has_menu, accept: "Control+k", send: Up }
    - { when: has_menu, accept: "Control+j", send: Down }
    - { when: has_menu, accept: "Control+2", send: "B" }
    - { when: has_menu, accept: "Control+3", send: "C" }
    - { when: has_menu, accept: "Control+4", send: "D" }
    - { when: has_menu, accept: "Control+5", send: "E" }
    #---------------------------------------------------
    - { when: composing, accept: "Control+1", send: "1" }
    - { when: composing, accept: "Control+2", send: "2" }
    - { when: composing, accept: "Control+3", send: "3" }
    - { when: composing, accept: "Control+4", send: "4" }
    - { when: composing, accept: "Control+5", send: "5" }
    - { when: composing, accept: "Control+6", send: "6" }
    - { when: composing, accept: "Control+7", send: "7" }
    - { when: composing, accept: "Control+8", send: "8" }
    #---------------------------------------------------

editor:
  bindings:
    space: commit                       # 選擇「備選漢字」
    Return: commit_script_text          # 上屏顯示的輸入：lau⁵ / lâu
    Shift+Return: commit_comment        # 上屏候選項備注：ㄉㄚ˪〖柳交五〗
    Control+Return: commit_raw_input    # 上屏原始的輸入：lau5

