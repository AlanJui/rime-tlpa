# Rime schema
# encoding: utf-8

schema:
  schema_id: tlpa_peh_ue-cu_im
  name: 河洛白話注音
  version: "0.0.0.1"
  author:
    - 居正中 <alanjui.1960@gmail.com>
  description: |
    河洛話白話音
    採用「TLPA標音方案」對漢字讀音編碼
    顯示注音符號

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - r10n_translator
    - reverse_lookup_translator
  filters:
    - simplifier
    - uniquifier

speller:
  #------------------------------------------------------
  # 定義使用者按下鍵盤時，輸入法能接受的按鍵
  #------------------------------------------------------
  # 0: 0
  # 1: ;
  # 2: \
  # 3: _
  # 4: [
  # 5: /
  # 6: <
  # 7: -
  # 8: ]
  # alphabet: "abcdefghijklmnopqrstuvwxyz~;\u005C\u005F[/<-]'"
  alphabet: 'abcdefghijklmnopqrstuvwxyz~;\[/<-]0'
  initials: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    #   零聲母處理
    - derive/Ø//
    #------------------------------------------------------
    # 定義字典中的 ‘漢字拼音’ 可與其它拼音法相容的規則
    #------------------------------------------------------
    # - derive/ou/oo/
    # - derive/e(ng|k)/i$1/
    # - derive/ei/e/
    # - derive/ee/e/
    #------------------------------------------------------
    # 定義：聲母簡拼
    #------------------------------------------------------
    - abbrev/^([ptkmnbglsjhiuc]g?s?h?h?).*/$1/
    #------------------------------------------------------
    # 設定讀取 ‘字典’ 漢字拼音的 ‘解析格式'
    #------------------------------------------------------
    - derive/^([a-z]+)\d$/$1/
    #------------------------------------------------------
    # 定義聲調的「調號」與「按鍵」的對映規則
    #------------------------------------------------------
    - xlit|12345678|;\_[/<-]|

translator:
  # dictionary: tlpa_sip_ngoo_im
  dictionary: tlpa_peh_ue
  spelling_hints: 5
  preedit_format:
    #------------------------------------------------------
    # 鼻化符號以 ‘上標n’ 顯示
    #------------------------------------------------------
    - xform/nn(h?)(\d|\>)/$1ⁿ$2/
    #------------------------------------------------------
    # 定義 ‘調號’ 的 '對映規則'
    #------------------------------------------------------
    - xlit|;\_[/<-]0|¹²³⁴⁵⁶⁷⁸⁰|
  comment_format:
    #======================================================
    # 令候選字視窗，可顯示兩組「注音/拼音」
    # 左邊：TLPA 拼音；右邊：十五音（河洛十八音）
    #======================================================
    - xform/^([Øa-z]+\d)$/$1;$1/
    #------------------------------------------------------
    # 定義 ‘聲母’ 在 ‘拼音字母’ 與 ‘方音符號’ 對映規則
    #------------------------------------------------------
    - xform/;p(?!h)/【ㄅ;/
    - xform/;ph/【ㄆ;/
    - xform/;m/【ㄇ;/
    - xform/;b/【ㆠ;/
    #------------------------------------------------------
    - xform/;t(?!h)/【ㄉ;/
    - xform/;th/【ㄊ;/
    - xform/;n(?!g)/【ㄋ;/
    - xform/;l/【ㄌ;/
    #------------------------------------------------------
    - xform/;k(?!h)/【ㄍ;/
    - xform/;kh/【ㄎ;/
    - xform/;h/【ㄏ;/
    - xform/;g/【ㆣ;/
    # - xform/;Øng/ㄫ/       # 先處理 ng，因為 ng 包含 n
    #------------------------------------------------------
    - xform/;c(?!h)/【ㄗ;/
    - xform/;ch/【ㄘ;/
    - xform/;s/【ㄙ;/
    - xform/;j/【ㆡ;/
    #======================================================
    # 韻母
    #======================================================
    # 不顥示 `零聲母` 處理 。
    # 1. 零聲母 + 元音韻母 + 調號，如：Øu5, Øi1, ...
    # 2. 零聲母 + 複合韻母 + 調號，如：Øiau1, Øiong2, Øuan2, Øuai1, ....
    # 3. 零聲母 + 鼻音化韻母 + 調號，如：Øann1, Øi1, ...
    #------------------------------------------------------
    # 務必放在首行
    - xform/;Ø(iau|ia|io|iu|ua|ue|ui|un|uang|uan)/【;$1/
    # 所有元音韻母、鼻韻輔音（聲母）
    - xform/;Ø(a|e|i|o|u|oo|m|ng)/【;$1/
    # 所有鼻韻韻母
    - xform/;Ø((a|e|i|o|u|ai)nn)/【;$1/
    # 所有組合韻母
    - xform/;Ø(ai|an|au|ang)/【;$1/
    #------------------------------------------------------
    # 優先排序調整
    - xform/;(io(ng|k))(\d)/ㄧㄜ;$2$3/
    #------------------------------------------------------
    - xform/;(u(n|t))(\d)/ㄨ;$2$3/
    - xform/;(ia(n|t))(\d)/ㄧㄚ;$2$3/
    - xform/;(i(m|p))(\d)/ㄧ;$2$3/
    - xform/;(ui(h?))(\d)/ㄨㄧ;$2$3/
    - xform/;(ee(h?))(\d)/ㆤ;$2$3/
    #------------------------------------------------------
    - xform/;(a(n|t))(\d)/ㄚ;$2$3/
    - xform/;(o(ng|k))(\d)/ㄜ;$2$3/
    - xform/;(uai(h?))(\d)/ㄨㄞ;$2$3/
    - xform/;(i(ng|k))(\d)/ㄧ;$2$3/
    - xform/;(ua(n|t))(\d)/ㄨㄚ;$2$3/
    #------------------------------------------------------
    - xform/;(oo(h?))(\d)/ㆦ;$2$3/
    - xform/;(iau(h?))(\d)/ㄧㄠ;$2$3/
    - xform/;ei(\d)/ㆤ;$1/
    # - xform/;(io(ng|k))(\d)/恭;$3/
    - xform/;(o(h?))(\d)/ㄜ;$2$3/
    #------------------------------------------------------
    - xform/;ai(\d)/ㄞ;$1/
    - xform/;(i(n|t))(\d)/ㄧ;$2$3/
    - xform/;(ia(ng|k))(\d)/ㄧㄚ;$2$3/
    - xform/;(a(m|p))/ㄚ;$2$3/
    - xform/;(ua(h?))(\d)/ㄨㄚ;$2$3/
    #------------------------------------------------------
    - xform/;(a(ng|k))/ㄚ;$2$3/
    - xform/;(ia(m|p))/ㄧㄚ;$2$3/
    - xform/;(au(h?))(\d)/ㄠ;$2$3/
    - xform/;(ia(h?))(\d)/ㄧㄚ;$2$3/
    - xform/;(ue(h?))(\d)/ㄨㆤ;$2$3/
    #------------------------------------------------------
    - xform/;(ann(h?))/ㆩ;$3/
    - xform/;(u(h?))(\d)/ㄨ;$2$3/
    - xform/;(a(h?))(\d)/ㄚ;$2$3/
    - xform/;(i(h?))(\d)/ㄧ;$2$3/
    - xform/;iu(\d)/ㄧㄨ;$1/
    #------------------------------------------------------
    - xform/;(enn(h?))(\d)/ㆥ;$2$3/
    - xform/;uinn(\d)/ㄨㆪ;$1/
    - xform/;(io(h?))(\d)/ㄧㄜ;$2$3/
    - xform/;(inn(h?))(\d)/ㆪ;$2$3/
    - xform/;ionn(\d)/ㄧㆧ;$1/
    #------------------------------------------------------
    - xform/;iann(\d)/ㄧㆩ;$1/
    - xform/;uann(\d)/ㄨㆩ;$1/
    - xform/;ng(\d)/ㄥ;$1/
    - xform/;(e(h?))(\d)/ㆤ;$2$3/
    - xform/;ainn(\d)/ㆮ;$1/
    #------------------------------------------------------
    - xform/;oonn(\d)/ㆧ;$1/
    - xform/;m(\d)/ㄇ;$1/
    - xform/;(ua(ng|k))(\d)/ㄨㄚ;$2$3/
    - xform/;(uainn(h?))(\d)/ㄨㆮ;$3/
    - xform/;uenn(\d)/ㄨㆥ;$1/
    #------------------------------------------------------
    - xform/;(iaunn(h?))/ㄧㆯ;$2$3/
    - xform/;(o(m|p))(\d)/ㄜ;$2$3/
    - xform/;aunn(\d)/ㆯ;$1/
    # 停用 `江(onn)` ，併入 `姑(onn/oonn)`
    # - xform/;onn(h?)/扛;/
    - xform/;(onn(h?))(\d)/ㆧ;$2$3/
    - xform/;iunn(\d)/ㄧㆫ;$1/
    #------------------------------------------------------
    # 校調
    #------------------------------------------------------
    # 替換 ng, n, m
    - xform/;ng(\d)/ㄥ;$1/
    - xform/;n(\d)/ㄣ;$1/
    - xform/;m(\d)/ㄇ;$1/
    #------------------------------------------------------
    # 入聲
    - xform/;p([48])/ㄅ;$1/
    - xform/;t([48])/ㄉ;$1/
    - xform/;k([48])/ㄍ;$1/
    - xform/;h([48])/ㄏ;$1/
    #------------------------------------------------------
    # 聲調
    #------------------------------------------------------
    - xform/;0/0】/
    - xform/;1/1】/
    - xform/;2/2】/
    - xform/;3/3】/
    - xform/;4/4】/
    - xform/;5/5】/
    - xform/;6/6】/
    - xform/;7/7】/
    - xform/;8/8】/
    #======================================================
    # 調整候選字視窗左半邊
    #======================================================
    # 鼻音韻母顯示：鼻化韻母以 ‘上標n’ 強調
    - 'xform/(nn)(h?)(\d)/ⁿ$2$3/'
    #------------------------------------------------------
    # 不顥示 `零聲母` 處理 。
    # 1. 零聲母 + 元音韻母 + 調號，如：Øu5, Øi1, ...
    # 2. 零聲母 + 複合韻母 + 調號，如：Øiau1, Øiong2, Øuan2, Øuai1, ....
    # 3. 零聲母 + 鼻音化韻母 + 調號，如：Øann1, Øi1, ...
    #------------------------------------------------------
    # 所有元音韻母、鼻韻輔音（聲母）
    - xform/Ø(a|e|i|o|u|oo|m|ng)(\d)/$1$2/
    # 所有鼻韻韻母
    - xform/Ø((a|e|i|o|u|ai)nn)(\d)/$1$3/
    # 所有組合韻母
    - xform/Ø(ai|an|au|ang)(\d)/$1$2/
    - xform/Ø(ia|io|iu|ua|ue|ui|un|uan|uang)(\d)/$1$2/
    #------------------------------------------------------
    # 顯示調號：標調務必放在 ’零聲母處理‘ 及 ’鼻音韻母顯示‘ 之後
    - 'xlit 123456780 ¹²³⁴⁵⁶⁷⁸⁰'

reverse_lookup:
  dictionary: luna_pinyin
  prefix: "`"
  tips: 〔拼音〕
  preedit_format:
    - xform/([nljqxy])v/$1ü/

key_binder:
  import_preset: default
  bindings:
    #---------------------------------------------------
    # 確保：按鍵 '-' 可當 '漢字拼音' 之第 7 調輸入
    - { when: has_menu, accept: minus, send: "-" }           # 確保 `-` 鍵用於聲調 7
    - { accept: minus, send: "-", when: composing }          # 確保 `-` 鍵用於聲調 7
    - { accept: minus, send: "-", when: always }             # 確保 `-` 鍵用於聲調 7
    #---------------------------------------------------
    # 翻頁
    # - { accept: comma, send: Page_Up, when: has_menu }         # 選下一個字
    # - { accept: period, send: Page_Down, when: has_menu }      # 選上一個字
    - { accept: "Control+p", send: Page_Up, when: composing }
    - { accept: "Control+n", send: Page_Down, when: composing }
    #---------------------------------------------------
    # Vim Mode
    #---------------------------------------------------
    - { when: has_menu, accept: "Control+h", send: Page_Up }
    - { when: has_menu, accept: "Control+l", send: Page_Down }
    - { when: has_menu, accept: "Control+k", send: Up }
    - { when: has_menu, accept: "Control+j", send: Down }
    #---------------------------------------------------
    - {accept: "Control+1", select: .next, when: always}
    - {accept: "Control+2", toggle: full_shape, when: always}
    - {accept: "Control+3", toggle: simplification, when: always}
    - {accept: "Control+4", toggle: extended_charset, when: always}

editor:
  bindings:
    space: commit                       # 選擇「備選漢字」
    Return: commit_script_text          # 上屏顯示的輸入：lau⁵ / lâu
    Shift+Return: commit_comment        # 上屏候選項備注：ㄉㄚ˪〖柳交五〗
    Control+Return: commit_composition    # 上屏原始的輸入：lau5
    # Control+Return: commit_raw_input    # 上屏原始的輸入：lau5
    # Control+Return: confirm    # 上屏原始的輸入：lau5

punctuator:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    reverse_lookup: "`[a-z]*$"
    punct: "^/([0-9]0?|[A-Za-z]+)$"

menu:
  alternative_select_labels: [ ①, ②, ③, ④, ⑤ ]  # 修改候選標籤
  alternative_select_keys: 12345 #如編碼字符佔用數字鍵則須另設選字鍵
  page_size: 5 #選單每䈎顯示個數

style:
  horizontal: false

