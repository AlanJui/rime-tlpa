# Rime schema
# vim: set sw= sts=2 et:
# encoding: utf-8

schema:
  schema_id: tlpa_peh_ue-cu_im
  name: 河洛白話注音
  version: "0.0.0.1"
  author:
    - 居正中 <alanjui.1960@gmail.com>
  description: |
    河洛話白話音
    採用「TLPA標音方案」對漢字讀音編碼
    顯示注音符號

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - r10n_translator
    - reverse_lookup_translator
  filters:
    - simplifier
    - uniquifier

speller:
  # alphabet: 'abcdefghijklmnopqrstuvwxyz~[/\]<>-=0'
  alphabet: 'abcdefghijklmnopqrstuvwxyz~=\_[/<-];'
  initials: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    # 零聲母處理
    # - xform/Ø/g/
    - derive/Ø//
    #------------------------------------------------------
    #   聲母簡拼
    - abbrev/^([ptkmnbglsjhiuc]g?s?h?h?).*/$1/
    #------------------------------------------------------
    # 與其它拼音法相容
    # - derive/ou/oo/
    # - derive/e(ng|k)/i$1/
    # - derive/ei/e/
    # - derive/ee/e/
    #------------------------------------------------------
    # 設定讀取 ‘字典’ 漢字拼音的 ‘解析格式'
    # - derive/^([Øa-z]+)\d$/$1/
    - derive/^([a-z]+)\d$/$1/
    #------------------------------------------------------
    # 對於已輸入（韻母）（調號）之拼音，需在韻母標「聲調符號」
    #------------------------------------------------------
    # 0: ;
    # 1: [
    # 2: \
    # 3: _
    # 4: [
    # 5: /
    # 6: <
    # 7: -
    # 8: ]
    - 'xlit 123456780 =\_[/<-];'

translator:
  # dictionary: tlpa_sip_ngoo_im
  dictionary: tlpa_peh_ue
  spelling_hints: 5
  preedit_format:
    #======================================================
    # 令候選字視窗，可顯示兩組「拼音/注音」
    # 左邊：拼音（TLPA 拼音字母）；右邊：注音符號。
    #======================================================
    - xform/^p(?!h)/ㄅ/
    - xform/^ph/ㄆ/
    - xform/^m/ㄇ/
    - xform/^b/ㆠ/
    #------------------------------------------------------
    - xform/^t(?!h)/ㄉ/
    - xform/^th/ㄊ/
    - xform/^n(?!g)/ㄋ/
    - xform/^l/ㄌ/
    #------------------------------------------------------
    - xform/^k(?!h)/ㄍ/
    - xform/^kh/ㄎ/
    - xform/^h/ㄏ/
    - xform/^g/ㆣ/
    # - xform/^Øng/ㄫ/       # 先處理 ng，因為 ng 包含 n
    #------------------------------------------------------
    - xform/^c(?!h)/ㄗ/
    - xform/^ch/ㄘ/
    - xform/^s/ㄙ/
    - xform/^j/ㆡ/
    #------------------------------------------------------
    # 韻母
    #------------------------------------------------------
    # 元音韻母
    - xform/a/ㄚ/  # 膠
    - xform/i/ㄧ/  # 居
    - xform/u/ㄨ/  # 艍
    - xform/e/ㆤ/  # 伽
    - xform/oo/ㆦ/  # 沽
    - xform/o/ㄜ/  # 高
    # 複合韻母
    - xform/ai/ㄞ/
    - xform/au/ㄠ/
    - xform/an/ㄢ/
    - xform/ang/ㄤ/
    # 韻化輔音
    - xform/ng/ㄥ/  # ng 當聲母：挾[ngeh8]；當韻母：黃[ng5]
    - xform/m/ㄇ/  # m 當聲母：麻[mua5]；當韻母：暗[am3]
    - xform/n/ㄣ/  # n 當韻母：運[un7]
    #------------------------------------------------------
    # 鼻韻處理
    #------------------------------------------------------
    # 組合韻母鼻韻處理
    - xform/ㄞㄣㄣ/ㆮ/  # ainn
    - xform/ㄠㄣㄣ/ㆯ/  # aunn
    # 元音鼻韻處理
    - xform/ㄚㄣㄣ/ㆩ/
    - xform/ㄧㄣㄣ/ㆪ/
    - xform/ㄨㄣㄣ/ㆫ/
    - xform/ㆤㄣㄣ/ㆥ/
    - xform/ㆦㄣㄣ/ㆧ/
    #------------------------------------------------------
    # 校調
    #------------------------------------------------------
    # 調整 ㄗ ㄘ ㄙ ㆡ 轉 ㄐ ㄑ ㄒ ㆢ
    - xform/ㄗㄧ/ㄐㄧ/
    - xform/ㄘㄧ/ㄑㄧ/
    - xform/ㄙㄧ/ㄒㄧ/
    - xform/ㆡㄧ/ㆢㄧ/
    # 複合韻母
    - xform/ㄚㄧ/ㄞ/
    - xform/ㄚㄨ/ㄠ/
    - xform/ㄚㄣ/ㄢ/
    # 複合半韻母（韻母鼻音化）
    - xform/ㄨㄚㆪ/ㄨㆮ/
    #------------------------------------------------------
    # 入聲
    #------------------------------------------------------
    # 上入調
    - xform/p8/ㆴ̇/
    - xform/t8/ㆵ̇/
    - xform/k8/ㆻ̇/
    - xform/h8/ㆷ̇/
    # 上入調
    - xform/p/ㆴ/
    - xform/t/ㆵ/
    - xform/k/ㆻ/
    - xform/h/ㆷ/
    # ok 指 ook
    - xform/ㄜ([ ㆴ ㆵ ㆻ ㆷ])/ㆦ$1/
    #------------------------------------------------------
    # 聲調
    #------------------------------------------------------
    # - 'xlit =\_[<-]; ¹²³⁴⁵⁶⁷⁸⁰'
    # - 'xform = ˉ'    #1
    # - 'xform \ ˋ'    #2
    # - 'xform _ ˪'    #3
    # - 'xform [ '     #4
    # - 'xform / ˊ'    #5
    # - 'xform < ˋ'    #2
    # - 'xform - ˫'    #7
    # - 'xform ] ˙'    #8
    # - 'xform ; 。'   #9 （輕聲在標準方音未定義）
  comment_format:
    #======================================================
    # 調整候選字視窗左半邊
    #
    # 處理 ’候選字視窗‘ (comment_format) ，會依據
    # ’拼音字母輸入視窗‘ (preedit_format) ，已輸入之拼音字母，
    # 顯示可能的候選漢字及其 TLPA 拼音碼。
    #
    # 此時的 TLPA  拼音碼，不顥示： ’零聲母‘ 。
    # 零聲母的格式有兩種：
    # 1. 零聲母 + 元音韻母 + 調號，如：Øu5, Øi1, ...
    # 2. 零聲母 + 複合韻母 + 調號，如：Øiau1, Øiong2, Øuan2, Øuai1, ....
    # 3. 零聲母 + 鼻音化韻母 + 調號，如：Øann1, Øi1, ...
    #
    # 以下的設定僅只能處理第 1 種格式：
    # - xform/Ø(a|e|i|o|u|oo|m|ng)(\d)/$1$2/
    #======================================================
    # - xform/Ø([aeiou]|oo|[aeiuo]{2,})(\d)/$1$2/
    # - xform/Ø([aeiou]|oo|[aeiou]{1,2}|m|ng)(\d)/$1$2/
    - xform/Ø(a|e|i|o|u|oo|m|ng)(\d)/$1$2/
    - xform/Ø(ai|an|au|ang)(\d)/$1$2/
    - xform/Ø(ia|io|iu|ua|ue|ui|un|uan|uang)(\d)/$1$2/
    #------------------------------------------------------
    # 鼻化符號以 ‘上標n’ 顯示
    - 'xform/(nn)(h?)(\d)/ⁿ$2$3/'
    #------------------------------------------------------
    # 調號以上標格式顯示
    - 'xlit 123456780 ¹²³⁴⁵⁶⁷⁸⁰'

reverse_lookup:
  dictionary: luna_pinyin
  prefix: "`"
  tips: 〔拼音〕
  preedit_format:
    - xform/([nljqxy])v/$1ü/

key_binder:
  import_preset: default
  bindings:
    # 確保 `=` 鍵用於聲調 1 (陰平：高平調)
    - { accept: equal, send: "=", when: composing }
    # 確保 `/` 鍵用於聲調 5 (陽平：上陽調)
    - { accept: slash, send: "/", when: composing }
    # 確保 `\` 鍵用於聲調 2 (陰上：高降調)
    - { accept: backslash, send: "\\", when: composing }
    # 確保 `<` 鍵用於聲調 6 (陽上：高揚調)
    - { accept: less, send: "<", when: composing }
    # 確保 `_` 鍵用於聲調 3 (陰去)
    - { accept: underscore, send: "_", when: composing }
    # 確保 `-` 鍵用於聲調 7 (陽去)
    - { accept: minus, send: "-", when: composing }
    # 確保 `[` 鍵用於聲調 4 (陰入)
    - { accept: bracketleft, send: "[", when: composing }
    # 確保 `]` 鍵用於聲調 8 (陽入)
    - { accept: bracketright, send: "]", when: composing }
    # 確保 `;` 鍵用於聲調 0
    - {accept: semicolon, send: ';', when: composing}
    #---------------------------------------------------
    # # 確保 `=` 鍵用於聲調 1 (陰平：高平調)
    # - { accept: equal, send: "1", when: composing }
    # # 確保 `/` 鍵用於聲調 5 (陽平：上陽調)
    # - { accept: slash, send: "5", when: composing }
    # # 確保 `\` 鍵用於聲調 2 (陰上：高降調)
    # - { accept: backslash, send: "2", when: composing }
    # # 確保 `<` 鍵用於聲調 6 (陽上：高揚調)
    # - { accept: less, send: "6", when: composing }
    # # 確保 `_` 鍵用於聲調 3 (陰去)
    # - { accept: underscore, send: "_", when: composing }
    # # 確保 `-` 鍵用於聲調 7 (陽去)
    # - { accept: minus, send: "7", when: composing }
    # # 確保 `[` 鍵用於聲調 4 (陰入)
    # - { accept: bracketleft, send: "4", when: composing }
    # # 確保 `]` 鍵用於聲調 8 (陽入)
    # - { accept: bracketright, send: "8", when: composing }
    # # 確保 `;` 鍵用於聲調 0
    # - {accept: semicolon, send: '0', when: composing}
    #---------------------------------------------------
    # 翻頁
    - { accept: comma, send: Page_Up, when: has_menu }         # 選下一個字
    - { accept: period, send: Page_Down, when: has_menu }      # 選上一個字
    - { accept: "Control+p", send: Page_Up, when: composing }
    - { accept: "Control+n", send: Page_Down, when: composing }
    #---------------------------------------------------
    # Vim Mode
    #---------------------------------------------------
    - { when: has_menu, accept: "Control+h", send: Page_Up }
    - { when: has_menu, accept: "Control+l", send: Page_Down }
    - { when: has_menu, accept: "Control+k", send: Up }
    - { when: has_menu, accept: "Control+j", send: Down }
    #---------------------------------------------------
    - {accept: "Control+1", select: .next, when: always}
    - {accept: "Control+2", toggle: full_shape, when: always}
    - {accept: "Control+3", toggle: simplification, when: always}
    - {accept: "Control+4", toggle: extended_charset, when: always}

editor:
  bindings:
    space: commit                       # 選擇「備選漢字」
    Return: commit_script_text          # 上屏顯示的輸入：lau⁵ / lâu
    Shift+Return: commit_comment        # 上屏候選項備注：ㄉㄚ˪〖柳交五〗
    # Control+Return: commit_raw_input    # 上屏原始的輸入：lau5
    # Control+Return: confirm    # 上屏原始的輸入：lau5
    Control+Return: commit_composition    # 上屏原始的輸入：lau5

punctuator:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    reverse_lookup: "`[a-z]*$"

menu:
  # alternative_select_labels: [ ①, ②, ③, ④, ⑤, ⑥, ⑦, ⑧, ⑨ ]  # 修改候選標籤
  # alternative_select_keys: ASDFGHJKL #如編碼字符佔用數字鍵則須另設選字鍵
  alternative_select_labels: [ ①, ②, ③, ④, ⑤ ]  # 修改候選標籤
  alternative_select_keys: 12345 #如編碼字符佔用數字鍵則須另設選字鍵
  page_size: 5 #選單每䈎顯示個數

style:
  horizontal: false

