# Rime schema
# encoding: utf-8

schema:
  schema_id: my_bopomofo
  name: 我的注音
  version: '0.0.2.10'
  author:
    - 居正中 AlanJui <alanjui.1960@gmail.com>
  description: |
    【輸入類型】：注音輸入法
    【拼音系統】：方音符號
    【注音符號】：方音符號
    【字典編碼】：台羅音標
    【聲調標示】：
      (1) 台羅八聲調；
      (2) 使用數值標示聲調，以利閱讀。
  dependencies:
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [漢文, ABC]
  - name: full_shape
    reset: 0
    states: [半形, 全形]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
    # - fluency_editor
    # - fluid_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - table_translator@custom_phrase
    - script_translator
  filters:
    - uniquifier

speller:
  alphabet: '1q!a2wsxyhnbYHNBedEgcuj8ik,9lUJ*I<(L-M0;Oomp/. 43657'
  initials: '1q!a2wsxyhnbYHNBedEgcuj8ik,9lUJ*I<(L-M0;Oomp/.'
  finals:   ' 43657'
  delimiter: "'"
  algebra:
    # --------------------------------------------------------------------------
    # 調整字典台語音標字母
    # 定義【台語音標】與【音標編碼】的對映關係
    # --------------------------------------------------------------------------
    # 去除零聲母
    - derive/Ø//
    # --------------------------------------------------------------------------
    # 令台羅拼音與台語音標相容： tsh = ch = c; ts = c = z
    # 舌尖前音（齒齦音）: z[c], c[ch], j[j], s[s]
    - xform/^tsh/c/	          
    - xform/^ts/z/	          
    # ==========================================================================
    # 變調
    # ==========================================================================
    - derive/6/7/
    # 舒聲變調 (17325)
    - derive/1/7/ # 第一調 → 第七調
    - derive/7/3/ # 第七調 → 第三調
    - derive/3/2/ # 第三調 → 第二調
    - derive/2/1/ # 第二調 → 第一調
    - derive/5/7/ # 第五調 → 第七調
    # 入聲變調（4 8）
    - derive/(?<![ptkh])4/8/ # -ㆷ 第四調 → 第八調
    - derive/(?<![ptkh])8/4/ # -ㆷ 第八調 → 第四調
    # ==========================================================================
    # 韻母編碼
    # ==========================================================================
    - xform/(oo|o)nn/Onn/
    - xform/oo/O/         # ㆦ (O) = oo ==> oo [ɔ] = O
    # --------------------------------------------------------------------------
    # 鼻音韻母： ann ==> nna ==> Na ==> Ba ==> ㄥㄚ ==> ㆩ
    # 設定鼻音韻母代表拼音字 ==> iann = ⁿia; ann = ⁿa
    # --------------------------------------------------------------------------
    # 複合鼻音韻母
    - derive/ainn/Y/      # ㆮ = ainn
    - derive/aunn/X/      # ㆯ = aunn
    # 元音鼻音韻母
    - derive/ann/A/       # ㆩ = ann
    - derive/inn/I/       # ㆪ = inn
    - derive/unn/U/       # ㆫ = unn
    - derive/enn/E/       # ㆥ = enn
    - derive/Onn/Q/       # ㆧ = onn
    # --------------------------------------------------------------------------
    - derive/([iu]?(ai|au|[iuaOe]))nn/ⁿ$1/	  # 鼻化韻母以 ‘上標n’ 強調
    # 複合韻母
    - xform/ai/y/         # ㄞ = ai  = y
    - xform/au/x/         # ㄠ = au  = x
    # 元音鼻音韻母
    - derive/ⁿa/A/        # ㆩ = ann
    - derive/ⁿi/I/        # ㆪ = inn
    - derive/ⁿu/U/        # ㆫ = unn
    - derive/ⁿe/E/        # ㆥ = enn
    - derive/ⁿO/Q/        # ㆧ = oonn
    # 複合鼻音韻母
    - derive/ⁿy/Y/        # ㆮ
    - derive/ⁿx/X/        # ㆯ
    # 設定鼻音韻母代表拼音字母
    # - derive/ⁿ([aiueoyx])/B$1/    # 鼻音韻母以【拼音字母編碼】以 B 代表
    - derive/ⁿ([aiueOyx])/B$1/    # 鼻音韻母以【拼音字母編碼】以 B 代表
    # -------------------------------------------------------------------------
    # 鼻音韻尾（m/ng/n）拼音字母編碼
    #--------------------------------------------------------------------------
    # ng ：預設當【韻母ㆭ】
    - xform/ng(?=\d)/W/   # ㆭ (W) = -ng：ng 後接調號，當【韻尾韻母】ㆭ = ㄥ
    # n ：預設當【聲母ㄋ】)
    - xform/n(?=\d)/N/    # ㄣ (N) = -n： n  後接調號，當【韻尾韻母】ㄣ，
    # m ：預設當【聲母ㄇ】
    - xform/m(?=\d)/M/    # ㆬ (M) = -m： m  後接調號，當【韻尾韻母】ㆬ = ㄇ
    # -------------------------------------------------------------------------
    # 校調 oo 韻母：oo 簡化成 o，如：ong/ok, om/op, onn, oonn
    # --------------------------------------------------------------------------
    # 以下韻母，拼音字母 o ，實為 oo 之縮寫，國際音標為：[ɔ] 
    - xform/io(?=[Wk])/iO/    # iong = iOng / iok = iOk
    - xform/o(?=[Wk])/O/      # ong = Ong / ok = Ok
    - xform/o(?=[Mp])/O/      # om = OM / op = Op
    # --------------------------------------------------------------------------
    # 鼻音韻尾編碼
    - derive/OW/H/        # ong = o + ng = O + W = ㆦ + ㆭ = ㆲ
    - derive/OM/D/        # om  = OM = ㆱ
    - derive/aW/G/        # ang = aW = G = ㄤ
    - derive/aN/@/        # an  = aN = @ = ㄢ
    - derive/aM/V/        # am = a + m = a + M = ㄚ + ㆬ = ㆰ
    # --------------------------------------------------------------------------
    # 泉州腔韻母
    - xform/ir/R/         # ㆨ = ir
    # ==========================================================================
    # 地方腔韻母
    # ==========================================================================
    - derive/er(W|k)/i$1/ # erng/erk
    - derive/er(N|t)/u$1/ # ern/ert
    - derive/ere/ue/
    - derive/er/e/
    - derive/ee/e/	  # 漳州/泉州腔
    - derive/ei/e/	  # 漳州腔
    - derive/ou/O/    # ou = oo = O
    - derive/ur/u/	  # 廈門腔
    # ==========================================================================
    # 聲母用台語音標編碼
    #  - 雙唇音: p, ph, b, m
    #  - 舌尖中音（齒齦音）: t, th, n, l
    #  - 舌根音（軟顎音）: k, kh, g, ng
    #  - 舌尖前音（齒齦音）: z(c), c(ch), j, s
    #  - 喉音（聲門音）：h
    # ==========================================================================
    # 舌尖前音（齒齦音）: z[c], c[ch], j[j], s[s]
    # - xform/^ch/c/       # ㄘ (c) = ch = tsh
    # - xform/^c(?!h)/z/   # ㄗ (z) = c  = ts （c 後非 h )
    # Zi-[zi-], Ci-[ci-], Si-[si-], Ji- [ji-]
    # - xform/z(?=i)/Z/    # ㄗ --> ㄐ
    # - xform/c(?=i)/C/    # ㄘ --> ㄑ
    # - xform/s(?=i)/S/    # ㄙ --> ㄒ
    # - xform/j(?=i)/J/    # ㆡ --> ㆢ
    #--------------------------------------------------------------------------
    # 雙唇音: p[p], P[ph], b[b], m[m]
    - xform/^ph/P/        # ㄆ (P) = ph
    # --------------------------------------------------------------------------
    # 舌尖中音（齒齦音）: t[t], T[th], n[n], l[l]
    - xform/^th/T/        # ㄊ (T) = th
    # --------------------------------------------------------------------------
    # 舌根音（軟顎音）: k[k], K[kh], g[g], ng[ng]
    - xform/^kh/K/        # ㄎ (K) = kh
    # ng 可為聲母，亦可為韻母
    # - xform/^ng(\D)/w/    # ㄫ (w) = ng ：ng 後面不接【數值】（即【調號】）
    - xform/^ng(?!\d)/w/    # ㄫ (w) = ng ：ng 後面不接【數值】（即【調號】）
    #--------------------------------------------------------------------------
    # 入聲韻尾轉換
    # (1) -m  ==> -p
    # (2) -n  ==> -t
    # (3) -ng ==> -k
    #
    # (1) ap, ip, iap,
    # (2) at, it, ut, iat, uat
    # (3) ak, ik, ok, iak, iok
    # (4) ah, ih, uh, eh, ooh, oh, aih, auh, iah, iuh, ioh, uah, uih, ueh, iauh, uaih
    #--------------------------------------------------------------------------
    # - derive/[48]/0/         # 設定【入聲】之【聲調】值，不論4或8，皆以0代
    - derive/p[48]/p0/
    - derive/t[48]/t0/
    - derive/k[48]/k0/
    - derive/h[48]/h0/
    #--------------------------------------------------------------------------
    # 設定讀取 ‘字典’ 漢字拼音的 ‘解析格式'
    #--------------------------------------------------------------------------
    - derive/^([A-Za-z]+)\d$/$1/
    #=======================================================================
    # 台語音標之拼音字母輸入【簡化規則】
    #=======================================================================
    # 只輸入【聲母】搜尋漢字
    - abbrev/^([pPbmtTnlzcjskKgwh]).+$/$1/   
    # 輸入【聲母】與【調號】搜尋漢字
    - abbrev/^([pPbmtTnlzcjskKgwh]).+(\d)$/$1/
    # 舒聲調（平、上、去聲）之漢字，可免調號（1/2/3/5/7）；但【入聲】（調號：4/8）不適用。
    - abbrev/^(\D+)([12357])$/$1/
    # 將入聲韻母+入聲調號統一為【0】: abbrev/[iuaoOeIUMLQYWNM]+[48]/0/  
    # - abbrev/^(ap|at|ak|ah|annh|aih|ainn|auh|aunnh|ek|eeh|eh|ennh|ip|it|ik|ih|innh|iap|iat|iak|iah|iannh|iauh|ioh|iok|iooh|iuh|iunnh|erh|oh|op|ok|ooh|onnh|irp|irt|irk|irh|ut|uh|uat|uah|ueeh|ueh|ereh|mh|ngh)1$/0/
    # - abbrev/(ap|at|ak|ah|Bah|yh|By|xh|Bxh|ek|eeh|eh|Beh|ip|it|ik|ih|Bih|iap|iat|iak|iah|Biah|ixh|iOh|iOk|iOh|iuh|Biuh|erh|oh|Op|Ok|Oh|Boh|irp|irt|irk|irh|ut|uh|uat|uah|ueeh|ueh|ereh|Mh|Wh)0/0/
    # 用 B 代表所有的鼻音母音
    # - abbrev/[iu]?B[iuaOeyx](\d)/B$1/  
    #-----------------------------------------------------------------------
    # 字典編碼轉換按鍵
    # 定義【拼音字元編碼】與【鍵盤按鍵】對映關聯
    #-----------------------------------------------------------------------
    - "xlit|pPbmtTnlzcjskKgwhiuaOoeyx@GRIUAQEYXVHWNMB123570|1q!a2wsxyhbnedEgcuj8ik,9l0;-UJ*I<(LMo/pm. 43657|"

translator:
  dictionary: tl_ji_khoo_peh_ue
  prism: my_bopomofo
  spelling_hints: 20
  comment_format:
    #--------------------------------------------------------------------------
    # 定義【候選字清單】
    #--------------------------------------------------------------------------
    __patch:
      - my_bopomofo_libs:/hau_suan_tuann
  preedit_format:
    #--------------------------------------------------------------------------
    # 定義【鍵盤輸入列】
    #--------------------------------------------------------------------------
    __patch:
      - my_bopomofo_libs:/jih_kian_tng_zu_im_hu_ho

custom_phrase:
  dictionary: ""
  user_dict: custom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 1

key_binder:
  import_preset: default
  bindings:
    #---------------------------------------------------
    # 確保：按鍵 '-' 可當 '漢字拼音' 之第 7 調輸入
    #---------------------------------------------------
    - { when: has_menu, accept: comma, send: comma }      # ㆤ
    - { when: has_menu, accept: period, send: period }    # ㆲ
    - { when: has_menu, accept: minus, send: minus }      # ｎ
    - { when: composing, accept: minus, send: minus }     # 確保 `-` 鍵可用
    # - { when: composing, accept: colon, send: colon }     # 確保 `:` 鍵可用
    # - { when: has_menu, accept: colon, send: colon }      # ㆤ
    - { when: composing, accept: colon, send: "ㆲ" }     # 確保 `:` 鍵可用
    - { when: has_menu, accept: colon, send: "ㆲ" }      # ㆤ
    # - { when: always, accept: colon, send: colon }      
    #---------------------------------------------------
    # 翻頁
    #---------------------------------------------------
    - { accept: "Control+p", send: Page_Up, when: composing }
    - { accept: "Control+n", send: Page_Down, when: composing }
    #---------------------------------------------------
    # Vim Mode
    #---------------------------------------------------
    - { when: has_menu, accept: "Control+h", send: Page_Up }
    - { when: has_menu, accept: "Control+l", send: Page_Down }
    - { when: has_menu, accept: "Control+k", send: Up }
    - { when: has_menu, accept: "Control+j", send: Down }

editor:
  bindings:
    space: commit                           # 選擇「備選漢字」
    Return: commit_composition              # 上屏原始的輸入：lau5
    Control+Return: commit_script_text      # 上屏顯示的輸入：lau⁵ / lâu
    Shift+Return: commit_comment            # 上屏候選項備注：ㄉㄚ˪〖柳交五〗
    Control+Shift+Return: commit_raw_input  # 將 Control+Return 綁定到 Lua 函數

menu:
  alternative_select_labels: [ ①, ②, ③, ④, ⑤ ]  # 修改候選標籤
  alternative_select_keys: 12345 #如編碼字符佔用數字鍵則須另設選字鍵
  page_size: 5 #選單每䈎顯示個數

style:
  horizontal: false
  font_face: "霞鶩文楷 TC, 新細明體"

recognizer:
  import_preset: default
  patterns:
    email: ^[a-z][-_.0-9a-z]*@.*$
    uppercase: ^[A-Z][-_+.'0-9A-Za-z]*$
    url: ^(www[.]|https?:|ftp:|mailto:).*$
    punct: '`[^\s]$'

punctuator:
  import_preset: keymap_piau_tian
